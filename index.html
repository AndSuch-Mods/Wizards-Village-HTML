<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mage Valley – Prototype Menu Flow</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;700&display=swap');

    :root {
      color-scheme: dark;
      --bg: radial-gradient(circle at 20% 15%, #23352f 0%, #0c1414 55%, #06090f 100%);
      --panel: linear-gradient(135deg, #1a2222, #0f1317);
      --accent: #cda555;
      --muted: #d1c9b6;
      --outline: rgba(255, 228, 180, 0.12);
      --pixel-noise: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='6' height='6'%3E%3Crect width='1' height='1' x='1' y='0' fill='%234a5a45'/%3E%3Crect width='1' height='1' x='4' y='1' fill='%234a5a45'/%3E%3Crect width='1' height='1' x='2' y='3' fill='%234a5a45'/%3E%3Crect width='1' height='1' x='5' y='4' fill='%234a5a45'/%3E%3Crect width='1' height='1' x='0' y='5' fill='%233f4d3e'/%3E%3C/svg%3E");
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      min-height: 100vh;
      margin: 0;
      background: var(--bg);
      color: #e7ecff;
      overflow: hidden;
      position: relative;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      background-image: var(--pixel-noise);
      background-size: 6px 6px;
      opacity: 0.35;
      mix-blend-mode: overlay;
      image-rendering: pixelated;
      z-index: 0;
    }

    main {
      width: 100vw;
      height: 100vh;
      background: linear-gradient(145deg, rgba(12, 20, 18, 0.9), rgba(7, 12, 14, 0.92));
      border: 1px solid var(--outline);
      box-sizing: border-box;
      padding: 20px;
      display: grid;
      grid-template-rows: auto 1fr;
      gap: 16px;
      position: relative;
      overflow: hidden;
      box-shadow: inset 0 0 0 2px rgba(0, 0, 0, 0.4), 0 20px 30px rgba(0, 0, 0, 0.45);
    }

    header {
      grid-column: 1 / -1;
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      border-bottom: 1px solid var(--outline);
      padding-bottom: 10px;
      margin-bottom: 6px;
      position: relative;
    }

    h1 {
      letter-spacing: 0.12em;
      font-size: 1.2rem;
      font-family: "Press Start 2P", "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #f5d78a;
      text-shadow: 0 2px 0 #1b1206, 0 0 12px rgba(255, 207, 126, 0.35);
    }

    #screenWrapper {
      grid-column: 1 / -1;
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      height: 100%;
    }

    .panel {
      background: var(--panel);
      border-radius: 8px;
      border: 1px solid var(--outline);
      padding: 16px 18px;
      box-shadow:
        0 0 0 2px rgba(0, 0, 0, 0.35),
        0 16px 0 rgba(0, 0, 0, 0.45),
        0 14px 32px rgba(0, 0, 0, 0.35);
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-height: 0;
      height: 100%;
      background-image:
        linear-gradient(180deg, rgba(255, 216, 146, 0.06), rgba(0, 0, 0, 0)),
        var(--pixel-noise);
      background-size: cover, 6px 6px;
      image-rendering: pixelated;
    }

    .panel h2 {
      font-size: 0.95rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #f0dfad;
      font-family: "Press Start 2P", "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    button, input, select {
      font: inherit;
    }

    .btn {
      background: linear-gradient(180deg, #4d7c43, #2f5136);
      color: #f2e8d0;
      border: 1px solid #0f0f0f;
      border-radius: 6px;
      padding: 10px 12px;
      font-weight: 700;
      letter-spacing: 0.04em;
      cursor: pointer;
      transition: transform 0.08s ease, box-shadow 0.08s ease, filter 0.1s ease;
      box-shadow: 0 6px 0 #0a0c0c, 0 10px 18px rgba(0, 0, 0, 0.4);
      text-transform: uppercase;
      image-rendering: pixelated;
    }

    .btn.secondary {
      background: linear-gradient(180deg, #3e5875, #27384f);
      color: #f3e5c9;
      box-shadow: 0 6px 0 #0c1118, 0 10px 18px rgba(0, 0, 0, 0.4);
    }

    .btn.ghost {
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.07), rgba(255, 255, 255, 0.02));
      color: #f0dfad;
      border: 1px solid var(--outline);
      box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.35);
      text-transform: none;
    }

    .btn:hover {
      transform: translateY(-1px);
      filter: brightness(1.06) saturate(1.05);
    }

    .btn:active { transform: translateY(0); box-shadow: 0 3px 0 #0a0c0c, 0 6px 12px rgba(0,0,0,0.4); }

    .screen {
      display: none;
      flex-direction: column;
      gap: 12px;
      height: 100%;
    }

    .screen.active { display: flex; }

    .stack {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .field label {
      display: block;
      font-size: 0.85rem;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .field input, .field select {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid var(--outline);
      color: #f7fbff;
    }

    .saveList {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .saveCard {
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--outline);
      background: rgba(255, 255, 255, 0.04);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .saveCard strong { color: #e7ecff; }
    .saveCard span { color: var(--muted); font-size: 0.85rem; }

    .gameLayout {
      display: flex;
      flex-direction: column;
      gap: 14px;
      height: 100%;
      position: relative;
    }

    .mapPanel {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--outline);
      border-radius: 12px;
      padding: 14px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02);
      display: flex;
      flex-direction: column;
      gap: 10px;
      flex: 1;
      min-height: 0;
      position: relative;
    }

    .mapPanel h3 {
      letter-spacing: 0.08em;
      font-size: 0.95rem;
      color: #d6ddff;
    }

    #mapView {
      flex: 1;
      background:
        radial-gradient(circle at 30% 20%, rgba(53, 87, 65, 0.4), transparent 40%),
        radial-gradient(circle at 75% 70%, rgba(35, 54, 42, 0.35), transparent 45%),
        repeating-linear-gradient(0deg, rgba(24, 44, 32, 0.7) 0 8px, rgba(17, 31, 25, 0.7) 8px 16px),
        repeating-linear-gradient(90deg, rgba(24, 44, 32, 0.7) 0 8px, rgba(17, 31, 25, 0.7) 8px 16px),
        #0a0f10;
      border-radius: 8px;
      border: 1px solid var(--outline);
      position: relative;
      overflow: hidden;
      flex: 1;
      min-height: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      image-rendering: pixelated;
      box-shadow: inset 0 0 0 2px rgba(0,0,0,0.35);
    }

    #mapView .mapOverlay {
      position: absolute;
      inset: 0;
      display: grid;
      grid-auto-rows: 1fr;
      grid-auto-columns: 1fr;
      gap: 2px;
      padding: 12px;
    }

    #mapView .tile {
      border: 1px solid rgba(9, 12, 10, 0.9);
      border-radius: 2px;
      background: rgba(255,255,255,0.02);
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,0.04),
        inset 0 -2px 0 rgba(0,0,0,0.35);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      letter-spacing: 0.04em;
      color: #e9dfc6;
      background-size: 8px 8px;
      background-image: linear-gradient(135deg, rgba(255,255,255,0.04) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.04) 50%, rgba(255,255,255,0.04) 75%, transparent 75%, transparent);
      image-rendering: pixelated;
    }

    #mapView .tile[data-type="forest"] { background-color: #1e382b; box-shadow: inset 0 0 0 1px #3d5b44, inset 0 -2px 0 rgba(0,0,0,0.5); }
    #mapView .tile[data-type="grass"] { background-color: #294831; box-shadow: inset 0 0 0 1px #4b6a4b, inset 0 -2px 0 rgba(0,0,0,0.5); }
    #mapView .tile[data-type="path"] { background-color: #6f5a3e; box-shadow: inset 0 0 0 1px #8c744f, inset 0 -2px 0 rgba(0,0,0,0.55); }
    #mapView .tile[data-type="mushroom"] { background-color: #7a3f3b; box-shadow: inset 0 0 0 1px #b06560, inset 0 -2px 0 rgba(0,0,0,0.55); }
    #mapView .tile[data-type="stump"] { background-color: #5c3b1f; box-shadow: inset 0 0 0 1px #9b6b3c, inset 0 -2px 0 rgba(0,0,0,0.55); }
    #mapView .tile[data-type="bush"] { background-color: #264534; box-shadow: inset 0 0 0 1px #3f6c4c, inset 0 -2px 0 rgba(0,0,0,0.55); }
    #mapView .tile[data-type="tower"] { background-color: #4c5666; box-shadow: inset 0 0 0 1px #76829b, inset 0 -2px 0 rgba(0,0,0,0.55); }
    #mapView .tile[data-type="door"] { background-color: #7c5a33; box-shadow: inset 0 0 0 1px #b48c55, inset 0 -2px 0 rgba(0,0,0,0.55); }
    #mapView .tile[data-type="window"] { background-color: #f2c46a; color: #1b1208; font-weight: 700; box-shadow: inset 0 0 0 1px #f8e8b0, inset 0 -2px 0 rgba(118, 86, 34, 0.8); }

    #mapView .mapLabel {
      position: absolute;
      left: 12px;
      bottom: 12px;
      background: rgba(5,8,7,0.7);
      padding: 8px 10px;
      border-radius: 4px;
      border: 1px solid var(--outline);
      color: #f0dfad;
      letter-spacing: 0.08em;
      font-family: "Press Start 2P", "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-size: 0.72rem;
      text-transform: uppercase;
    }

    .heroMarker {
      position: absolute;
      bottom: 12%;
      left: 50%;
      transform: translateX(-50%);
      filter: drop-shadow(0 10px 16px rgba(0,0,0,0.45));
    }

    #mapHero {
      --hat: #4f658f;
      --shirt: #5b816e;
      --pants: #39485a;
      --robe: #7c6239;
      position: relative;
      width: 82px;
      height: 122px;
      transform: scale(0.95);
      transform-origin: bottom;
    }

    .resourceGrid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    .resourceCard {
      border: 1px solid var(--outline);
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.03);
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .resourceCard h5 {
      letter-spacing: 0.06em;
      color: #f0dfad;
      font-size: 0.95rem;
      text-transform: uppercase;
    }

    .tagRow {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .tag {
      background: rgba(205, 165, 85, 0.14);
      color: #f6e2b9;
      border: 1px solid var(--outline);
      border-radius: 4px;
      padding: 4px 8px;
      font-size: 0.75rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }

    .resourceCard ul {
      padding-left: 18px;
      color: var(--muted);
      line-height: 1.4;
    }

    .codeBlock {
      background: rgba(0, 0, 0, 0.35);
      border: 1px solid var(--outline);
      border-radius: 6px;
      padding: 10px;
      font-family: "Fira Code", "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
      color: #f6eed6;
      font-size: 0.85rem;
      line-height: 1.35;
      overflow-x: auto;
      box-shadow: inset 0 0 0 2px rgba(0,0,0,0.4);
    }

    .legendList {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 6px;
      color: var(--muted);
    }

    .avatar .hat {
      position: absolute;
      top: 2px;
      left: 10px;
      width: 60px;
      height: 20px;
      background: linear-gradient(180deg, var(--hat), #2a2d32);
      border-radius: 2px;
      box-shadow: inset 0 -2px 0 rgba(0,0,0,0.45), 0 0 0 2px rgba(0,0,0,0.6);
    }

    .avatar .head {
      position: absolute;
      top: 20px;
      left: 22px;
      width: 36px;
      height: 32px;
      background: linear-gradient(180deg, #d8b78a 60%, #b6895b);
      border-radius: 4px;
      box-shadow: inset 0 -2px 0 rgba(0,0,0,0.35), 0 0 0 2px rgba(0,0,0,0.45);
    }

    .avatar .robe {
      position: absolute;
      top: 50px;
      left: 8px;
      width: 64px;
      height: 68px;
      background: linear-gradient(180deg, var(--robe), #1e2028);
      border-radius: 3px;
      box-shadow: inset 0 0 0 2px rgba(0,0,0,0.25), 0 0 0 2px rgba(0,0,0,0.6);
    }

    .avatar .shirt {
      position: absolute;
      top: 60px;
      left: 16px;
      width: 48px;
      height: 36px;
      background: linear-gradient(180deg, var(--shirt), #1f2a33);
      border-radius: 2px;
      box-shadow: inset 0 -2px 0 rgba(0,0,0,0.3), 0 0 0 2px rgba(0,0,0,0.4);
    }

    .avatar .pants {
      position: absolute;
      bottom: 6px;
      left: 18px;
      width: 44px;
      height: 26px;
      background: linear-gradient(180deg, var(--pants), #0f1318);
      border-radius: 2px;
      box-shadow: inset 0 -2px 0 rgba(0,0,0,0.32), 0 0 0 2px rgba(0,0,0,0.55);
    }

    .avatar .staff {
      position: absolute;
      right: -6px;
      top: 18px;
      width: 8px;
      height: 96px;
      background: linear-gradient(180deg, #caa366, #8d6a33);
      border-radius: 2px;
      box-shadow: inset 0 -2px 0 rgba(0,0,0,0.45), 0 0 0 2px rgba(0,0,0,0.55);
    }

    .avatar .orb {
      position: absolute;
      right: -14px;
      top: 6px;
      width: 18px;
      height: 18px;
      border-radius: 4px;
      background: radial-gradient(circle at 30% 30%, #fff8cf, #f2c46a);
      box-shadow: 0 0 0 2px rgba(0,0,0,0.4), 0 0 12px rgba(242,196,106,0.8);
    }

    #characterPreview {
      --hat: #6480b8;
      --shirt: #6ba089;
      --pants: #435266;
      --robe: #9c7e4a;
      position: relative;
      width: 120px;
      height: 160px;
      background:
        radial-gradient(circle at 40% 20%, rgba(69, 114, 83, 0.4), transparent 55%),
        radial-gradient(circle at 70% 70%, rgba(34, 53, 45, 0.35), transparent 60%),
        #0f1919;
      border: 1px solid var(--outline);
      border-radius: 8px;
      display: grid;
      place-items: center;
      padding: 8px;
      box-shadow: inset 0 0 0 2px rgba(0,0,0,0.45);
      image-rendering: pixelated;
    }

    .avatar {
      position: relative;
      width: 84px;
      height: 122px;
      filter: drop-shadow(0 6px 0 rgba(0,0,0,0.45));
      image-rendering: pixelated;
    }

    .pieceLabels {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px;
      font-size: 0.8rem;
      color: var(--muted);
      margin-top: 6px;
      text-align: center;
    }

    .characterMenu {
      background: rgba(5, 7, 20, 0.96);
      border: 1px solid var(--outline);
      border-radius: 12px;
      padding: 14px;
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.6);
      display: none;
      flex-direction: column;
      gap: 12px;
      position: absolute;
      inset: 30px;
      max-width: 540px;
      overflow: auto;
      z-index: 3;
    }

    .characterMenu.active { display: flex; }

    .characterMenuHeader {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .tabBar {
      display: flex;
      gap: 6px;
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--outline);
      border-radius: 10px;
      padding: 6px;
    }

    .tabBar button {
      background: transparent;
      border: 1px solid transparent;
      border-radius: 8px;
      color: #e7ecff;
      padding: 8px 10px;
      cursor: pointer;
      letter-spacing: 0.04em;
      transition: transform 0.1s ease, border-color 0.1s ease, background-color 0.1s ease;
    }

    .tabBar button.active {
      border-color: var(--accent);
      background: rgba(156,209,100,0.12);
      box-shadow: 0 10px 24px rgba(0,0,0,0.25);
      transform: translateY(-1px);
      color: #dff7b6;
    }

    .tabContent {
      display: none;
      flex-direction: column;
      gap: 10px;
      padding: 10px;
      border-radius: 10px;
      border: 1px dashed var(--outline);
      background: rgba(255,255,255,0.02);
      min-height: 140px;
    }

    .tabContent.active { display: flex; }

    .inlineFields {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
    }

    .inventoryList {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 8px;
    }

    .inventoryCard {
      padding: 10px;
      border-radius: 10px;
      border: 1px solid var(--outline);
      background: rgba(255,255,255,0.03);
      display: grid;
      gap: 4px;
    }

    .inventoryCard small { color: var(--muted); }

    .badge {
      display: inline-block;
      background: rgba(156, 209, 100, 0.12);
      color: #c4f08f;
      border: 1px solid rgba(156,209,100,0.3);
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      letter-spacing: 0.04em;
    }

    .flexBetween { display: flex; justify-content: space-between; align-items: center; gap: 8px; }

    @media (max-width: 860px) {
      main { grid-template-columns: 1fr; }
      #screenWrapper { grid-template-columns: 1fr; }
      #mapView { min-height: 280px; }
    }
  </style>
</head>
<body>
  <main>
    <header>
      <div>
        <h1>MAGE VALLEY</h1>
      </div>
      <button class="btn ghost" id="backToStart" aria-label="Back to start menu">Back</button>
    </header>

    <section id="screenWrapper">
      <div class="panel">
        <div id="startScreen" class="screen active" role="group" aria-label="Start screen">
          <div class="stack">
            <button class="btn" id="newCharacter">New Character</button>
            <button class="btn secondary" id="openSaves">Load Save</button>
          </div>
        </div>

        <div id="saveScreen" class="screen" role="group" aria-label="Save selection">
          <div class="saveList" id="saveList"></div>
          <button class="btn ghost" id="saveBack">Back to Start</button>
        </div>

        <div id="characterScreen" class="screen" role="group" aria-label="Character creation">
          <div class="field">
            <label for="charName">Name</label>
            <input id="charName" type="text" placeholder="E.g., Liora" />
          </div>
          <div class="field">
            <label for="charFocus">Focus</label>
            <select id="charFocus">
              <option value="Elemental">Elemental</option>
              <option value="Restoration">Restoration</option>
              <option value="Arcane">Arcane</option>
            </select>
          </div>
          <div class="field">
            <label for="charArchetype">Archetype</label>
            <select id="charArchetype">
              <option value="femaleApprentice">Female apprentice (warm moss)</option>
              <option value="maleApprentice">Male apprentice (dusk ash)</option>
            </select>
          </div>
          <button class="btn" id="createCharacter">Create Character</button>
          <button class="btn ghost" id="characterBack">Back</button>
        </div>

        <div id="zoneScreen" class="screen" role="group" aria-label="Zone selection">
          <div class="stack">
            <button class="btn" data-zone="Forest" id="startForest">Forest (prototype)</button>
          </div>
          <button class="btn ghost" id="zoneBack">Back</button>
        </div>

        <div id="gameScreen" class="screen" role="group" aria-label="Placeholder game area">
          <div class="gameLayout">
            <div class="mapPanel">
              <div class="flexBetween">
                <div style="display: flex; gap: 8px; align-items: center;">
                  <h3 id="mapTitle">FOREST</h3>
                  <span class="badge" id="zoneBadge">Safe zone</span>
                </div>
                <button class="btn ghost" id="openCharacterMenu">Character Menu</button>
              </div>
              <div id="mapView" aria-label="Zone map">
                <div class="mapOverlay" aria-hidden="true"></div>
                <div class="heroMarker" aria-label="Your character">
                  <div id="mapHero" class="avatar" aria-hidden="true">
                    <div class="hat"></div>
                    <div class="head"></div>
                    <div class="robe"></div>
                    <div class="shirt"></div>
                    <div class="pants"></div>
                    <div class="staff"></div>
                    <div class="orb"></div>
                  </div>
                </div>
                <div class="mapLabel">Emerald Approach — prototype map</div>
              </div>
              <div class="legendList" id="mapLegend"></div>
            </div>

            <div class="characterMenu" id="characterMenu" aria-label="Character menu" aria-hidden="true">
              <div class="characterMenuHeader">
                <div>
                  <h3 id="heroName">Apprentice</h3>
                  <p id="heroFocus" style="color: var(--muted)">Focus: Elemental • Zone: Forest</p>
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                  <div id="characterPreview" aria-label="Character preview">
                    <div class="avatar">
                      <div class="hat" aria-hidden="true"></div>
                      <div class="head" aria-hidden="true"></div>
                      <div class="robe" aria-hidden="true"></div>
                      <div class="shirt" aria-hidden="true"></div>
                      <div class="pants" aria-hidden="true"></div>
                      <div class="staff" aria-hidden="true"></div>
                      <div class="orb" aria-hidden="true"></div>
                    </div>
                    <div class="pieceLabels">
                      <span id="hatLabel">Wide Brim</span>
                      <span id="robeLabel">Robe: Twilight</span>
                      <span id="shirtLabel">Tunic: Meadow</span>
                      <span id="pantsLabel">Pants: Midnight</span>
                    </div>
                  </div>
                  <button class="btn ghost" id="closeCharacterMenu" aria-label="Close character menu">Close (C)</button>
                </div>
              </div>

              <div class="tabBar" id="gameTabs" role="tablist">
                <button data-tab-target="inventory" class="active" role="tab" aria-selected="true">Inventory</button>
                <button data-tab-target="quests" role="tab" aria-selected="false">Quests</button>
                <button data-tab-target="map" role="tab" aria-selected="false">Map</button>
                <button data-tab-target="people" role="tab" aria-selected="false">People</button>
                <button data-tab-target="settings" role="tab" aria-selected="false">Settings</button>
                <button data-tab-target="save" role="tab" aria-selected="false">Save / Exit</button>
              </div>

              <div id="inventory" class="tabContent active" role="tabpanel">
                <div class="inlineFields">
                  <div class="field">
                    <label for="hatStyle">Hat</label>
                    <select id="hatStyle"></select>
                  </div>
                  <div class="field">
                    <label for="hatColor">Hat Color</label>
                    <select id="hatColor"></select>
                  </div>
                  <div class="field">
                    <label for="shirtColor">Shirt Color</label>
                    <select id="shirtColor"></select>
                  </div>
                  <div class="field">
                    <label for="pantsColor">Pants Color</label>
                    <select id="pantsColor"></select>
                  </div>
                  <div class="field">
                    <label for="robeColor">Robe Color</label>
                    <select id="robeColor"></select>
                  </div>
                </div>
                <div class="inventoryList" id="inventoryList"></div>
              </div>

              <div id="quests" class="tabContent" role="tabpanel">
                <h4>Active quests</h4>
                <ul>
                  <li>Meet the village elder at the hilltop shrine.</li>
                  <li>Gather three sprigs of moonmint.</li>
                </ul>
              </div>

      <div id="map" class="tabContent" role="tabpanel">
        <h4>World map</h4>
        <p style="color: var(--muted); line-height: 1.5;">
          Cozy 3/4 top-down fantasy kit: muted forest greens, warm lantern gold, cool slate shadows,
          rounded silhouettes, and tiles readable at 64×64. Everything below is scoped to the new mage
          tower starting area and its nearby village road.
        </p>

        <div class="resourceGrid">
          <div class="resourceCard">
            <h5>Town tileset (64×64)</h5>
            <div class="tagRow">
              <span class="tag">cobblestone</span>
              <span class="tag">lantern glow</span>
              <span class="tag">warm timber</span>
              <span class="tag">shadowed edges</span>
            </div>
            <ul>
              <li>Ground: cobblestone loops, dirt side paths, mossy grass tufts, soft shadow vignette corners.</li>
              <li>Architecture: timber walls with stone footings, mossy teal shingles, chimney, dormer, stone stoop.</li>
              <li>Details: wooden floor planks, double + single doors, shuttered + glowing windows, hanging sign post,
                free-standing lantern post, stacked crates/barrels.</li>
              <li>All ground + wall tiles align on a 64px grid with seamless edges and mirrored variants.</li>
            </ul>
          </div>

          <div class="resourceCard">
            <h5>Forest &amp; mage tower tileset (64×64)</h5>
            <div class="tagRow">
              <span class="tag">fern + bush</span>
              <span class="tag">runic stone</span>
              <span class="tag">tower base</span>
            </div>
            <ul>
              <li>Ground: pine-needle forest floor, packed dirt curves, grassy clearing patches, edge shadow tiles for dense woods.</li>
              <li>Flora + scatter: layered bushes, ferns, mushrooms in red + umber, stumps (fresh + mossy),
                fallen log halves, pebble + boulder clusters.</li>
              <li>Tower: round stone wall bands, curved roof base, rune-etched entry stone, door + steps,
                glowing windows, subtle magic floor runes, planter pots.</li>
              <li>Forest boundary tiles form a soft tree wall with darker silhouettes and teal nightfall shadows.</li>
            </ul>
          </div>

          <div class="resourceCard">
            <h5>Player characters</h5>
            <div class="tagRow">
              <span class="tag">male</span>
              <span class="tag">female</span>
              <span class="tag">3 frames × 4 dirs</span>
            </div>
            <ul>
              <li>Proportions match reference: 64px tall, rounded faces, soft outlines.</li>
              <li>Directions: up / down / left / right with idle + two-step walk (mid-step, opposite step).</li>
              <li>Outfits: linen tunic, leather belt, boots; palette in moss, dusk blue, charcoal shadow ramps.</li>
              <li>Highlights stay warm; shadows drift into blue-violet for dusk mood.</li>
            </ul>
          </div>

          <div class="resourceCard">
            <h5>NPC roster</h5>
            <div class="tagRow">
              <span class="tag">blacksmith</span>
              <span class="tag">herbalist</span>
              <span class="tag">town guard</span>
              <span class="tag">child</span>
            </div>
            <ul>
              <li>Shared scale/style with players, soft earth palette with warm rim lights.</li>
              <li>Each has 4 directions with 2–3 walk frames; idle doubles as frame one.</li>
              <li>Visual hooks: apron + hammer (smith), satchel + herb wreath (herbalist),
                short cloak + spear (guard), oversized tunic + sling bag (child).</li>
              <li>Silhouettes stay readable when downscaled; outlines stay rounded and low-contrast.</li>
            </ul>
          </div>

          <div class="resourceCard">
            <h5>Starting area map (64px grid)</h5>
            <div class="codeBlock" aria-label="Tile grid layout">
              <pre style="margin: 0;">
TTTTTTTTTTTTT
TGGGGGGGGGGGT
TGbbbGPbbbGGT
TGbGPPGGPbGGT
TGGPPMTPPGGGT
TGPPrDDDPPGGT
TGGPPMWPPGGGT
TGbGPPGGPbGGT
TGbbbGPbbbGGT
TGGGGGGGGGGGT
TTTTTTTTTTTTT
              </pre>
            </div>
            <div class="legendList">
              <span><strong>T</strong> – tree edge / forest wall</span>
              <span><strong>G</strong> – grass clearing tile</span>
              <span><strong>P</strong> – packed dirt path</span>
              <span><strong>M</strong> – mushrooms</span>
              <span><strong>r</strong> – round stump</span>
              <span><strong>b</strong> – bush / fern clusters</span>
              <span><strong>W</strong> – glowing tower window tile</span>
              <span><strong>D</strong> – tower door + stone steps</span>
              <span><strong>T</strong> center ring wraps tower base tiles.</span>
            </div>
            <p style="color: var(--muted);">
              The tower sits center with a looping path to the south and branches east/west; mushrooms and stumps
              mark points of interest for early foraging. Edges use darker forest wall tiles to vignette the clearing.
            </p>
          </div>

          <div class="resourceCard">
            <h5>File structure</h5>
            <div class="codeBlock" aria-label="Planned asset folders">
              <pre style="margin: 0;">
art/
  tilesets/
    town_tileset.png
    forest_tileset.png
    tower_tileset.png
  characters/
    player_male_spritesheet.png
    player_female_spritesheet.png
  npcs/
    blacksmith_spritesheet.png
    herbalist_spritesheet.png
    guard_spritesheet.png
    child_spritesheet.png
maps/
  tower_clearing_64x64.json
              </pre>
            </div>
            <p style="color: var(--muted);">Tilesets are cuttable on a 64×64 grid; sprite sheets pack 3×4 frames per row for quick import.</p>
          </div>
        </div>
      </div>

              <div id="people" class="tabContent" role="tabpanel">
                <h4>People nearby</h4>
                <div id="peopleList" class="resourceGrid"></div>
              </div>

              <div id="settings" class="tabContent" role="tabpanel">
                <h4>Settings</h4>
                <div class="field">
                  <label for="musicVolume">Music Volume</label>
                  <input id="musicVolume" type="range" min="0" max="100" value="70" />
                </div>
                <div class="field">
                  <label for="uiScale">UI Scale</label>
                  <select id="uiScale">
                    <option>Comfort</option>
                    <option>Cozy</option>
                    <option>Compact</option>
                  </select>
                </div>
              </div>

              <div id="save" class="tabContent" role="tabpanel">
                <div class="stack">
                  <button class="btn secondary" id="saveProgress">Save Progress</button>
                  <button class="btn ghost" id="gameBack">Exit to Start</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </section>
  </main>

  <script>
    const screens = {
      start: document.getElementById('startScreen'),
      save: document.getElementById('saveScreen'),
      character: document.getElementById('characterScreen'),
      zone: document.getElementById('zoneScreen'),
      game: document.getElementById('gameScreen'),
    };

    const saveList = document.getElementById('saveList');
    const backButton = document.getElementById('backToStart');
    const mapOverlay = document.querySelector('#mapView .mapOverlay');
    const mapHero = document.getElementById('mapHero');
    const mapLegend = document.getElementById('mapLegend');
    const mapLabel = document.querySelector('.mapLabel');
    const inventoryList = document.getElementById('inventoryList');
    const characterMenu = document.getElementById('characterMenu');
    const openCharacterMenu = document.getElementById('openCharacterMenu');
    const closeCharacterMenu = document.getElementById('closeCharacterMenu');
    const peopleList = document.getElementById('peopleList');
    const archetypeSelect = document.getElementById('charArchetype');
    const gearSelects = {
      hatStyle: document.getElementById('hatStyle'),
      hatColor: document.getElementById('hatColor'),
      shirtColor: document.getElementById('shirtColor'),
      pantsColor: document.getElementById('pantsColor'),
      robeColor: document.getElementById('robeColor'),
    };
    const gearLabels = {
      hat: document.getElementById('hatLabel'),
      shirt: document.getElementById('shirtLabel'),
      pants: document.getElementById('pantsLabel'),
      robe: document.getElementById('robeLabel'),
    };

    const appearancePresets = {
      femaleApprentice: {
        hatStyle: 'Wide Brim',
        hatColor: 'Dusk',
        shirtColor: 'Meadow',
        pantsColor: 'Midnight',
        robeColor: 'Twilight',
      },
      maleApprentice: {
        hatStyle: 'Traveler Cap',
        hatColor: 'Charcoal',
        shirtColor: 'Moss',
        pantsColor: 'Charcoal',
        robeColor: 'Dusk',
      },
    };

    const archetypeLabels = {
      femaleApprentice: 'Apprentice (F)',
      maleApprentice: 'Apprentice (M)',
    };

    const tileLegend = {
      T: { label: 'Tree wall / forest edge', type: 'forest' },
      G: { label: 'Grass clearing', type: 'grass' },
      P: { label: 'Packed dirt path', type: 'path' },
      M: { label: 'Mushroom cluster', type: 'mushroom' },
      r: { label: 'Round stump', type: 'stump' },
      b: { label: 'Bush / fern cluster', type: 'bush' },
      W: { label: 'Glowing tower window', type: 'window' },
      D: { label: 'Tower door + stone steps', type: 'door' },
    };

    const towerClearingLayout = [
      'TTTTTTTTTTTTT',
      'TGGGGGGGGGGGT',
      'TGbbbGPbbbGGT',
      'TGbGPPGGPbGGT',
      'TGGPPMTPPGGGT',
      'TGPPrDDDPPGGT',
      'TGGPPMWPPGGGT',
      'TGbGPPGGPbGGT',
      'TGbbbGPbbbGGT',
      'TGGGGGGGGGGGT',
      'TTTTTTTTTTTTT',
    ];

    const npcRoster = [
      { role: 'Blacksmith', look: 'Apron, hammer, rolled sleeves', vibe: 'Sturdy helper who forges starter gear.' },
      { role: 'Herbalist', look: 'Satchel, herb wreath, soft shawl', vibe: 'Gathers moonmint and brews tonics.' },
      { role: 'Town Guard', look: 'Short cloak, spear, light helm', vibe: 'Keeps watch on the path to the tower.' },
      { role: 'Child', look: 'Oversized tunic, sling bag', vibe: 'Offers rumors and collects shinies.' },
    ];

    const saveKey = 'mageValleyPrototypeSaves';
    let currentCharacter = null;

    const hatStyles = ['Wide Brim', 'Traveler Cap', 'Circlet', 'Hood', 'No Hat'];
    const colorPalette = {
      Twilight: '#d3b7ff',
      Meadow: '#82e0b5',
      Midnight: '#2f3f6b',
      Ember: '#f5a072',
      Dusk: '#7ea5ff',
      Charcoal: '#4c536d',
      Moss: '#6ccf7a',
    };
    const inventoryItems = [
      { name: 'Apprentice Hat', slot: 'Head', notes: 'Swappable brim styles for your mentor look.' },
      { name: 'Layered Tunic', slot: 'Torso', notes: 'Soft linen dyed in travel-safe colors.' },
      { name: 'Spell-scribe Robe', slot: 'Robe', notes: 'Robe panels reinforced for glyph stitching.' },
      { name: 'Traveler Pants', slot: 'Legs', notes: 'Weather-ready trousers with hidden pockets.' },
      { name: 'Birchwood Staff', slot: 'Hand', notes: 'Channeling focus with a skyglass orb.' },
    ];

    function getDefaultAppearance(archetype = 'femaleApprentice') {
      return { ...appearancePresets[archetype] };
    }

    function ensureAppearance(base) {
      const preset = getDefaultAppearance(base?.archetype || 'femaleApprentice');
      return { ...preset, ...(base?.appearance || {}) };
    }

    const defaultMapLabel = 'Emerald Approach — mage tower start';

    if (mapLabel) mapLabel.textContent = defaultMapLabel;

    function setPreview(message) {
      if (!mapLabel || !message) return;
      mapLabel.textContent = message;
      setTimeout(() => {
        mapLabel.textContent = defaultMapLabel;
      }, 1800);
    }

    function hideAllScreens() {
      Object.values(screens).forEach((el) => el.classList.remove('active'));
    }

    function showScreen(screenName) {
      hideAllScreens();
      const target = screens[screenName];
      if (target) {
        target.classList.add('active');
      }
      switch (screenName) {
        case 'start':
          break;
        case 'save':
          renderSaves();
          break;
        case 'character':
          break;
        case 'zone':
          break;
        case 'game':
          const zone = currentCharacter?.zone || 'Forest';
          document.getElementById('mapTitle').textContent = zone.toUpperCase();
          document.getElementById('zoneBadge').textContent = zone.toLowerCase() === 'forest' ? 'Safe zone' : 'Zone loaded';
          activateTab('inventory');
          hydrateGameUI();
          toggleCharacterMenu(false);
          break;
      }
    }

    function loadSaves() {
      try {
        const raw = localStorage.getItem(saveKey);
        const parsed = raw ? JSON.parse(raw) : [];
        const save = Array.isArray(parsed) ? parsed[0] : parsed;
        if (!save) return [];
        return [{ ...save, archetype: save.archetype || 'femaleApprentice', appearance: ensureAppearance(save) }];
      } catch (err) {
        console.warn('Unable to load saves', err);
        return [];
      }
    }

    function persistSaves(saves) {
      try {
        localStorage.setItem(saveKey, JSON.stringify(saves));
      } catch (err) {
        console.warn('Unable to save progress', err);
      }
    }

    function renderSaves() {
      const saves = loadSaves();
      saveList.innerHTML = '';
      if (!saves.length) {
        const empty = document.createElement('p');
        empty.textContent = 'No saves yet. Create a character to begin.';
        empty.style.color = 'var(--muted)';
        saveList.appendChild(empty);
        return;
      }

      saves.forEach((save) => {
        const card = document.createElement('div');
        card.className = 'saveCard';
        const info = document.createElement('div');
        info.innerHTML = `<strong>${save.name}</strong><br><span>Focus: ${save.focus} • Zone: ${save.zone || 'Forest'}</span>`;

        const actions = document.createElement('div');
        actions.style.display = 'flex';
        actions.style.gap = '8px';

        const loadBtn = document.createElement('button');
        loadBtn.className = 'btn secondary';
        loadBtn.textContent = 'Load';
        loadBtn.addEventListener('click', () => {
          currentCharacter = save;
          showScreen('game');
        });

        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'btn ghost';
        deleteBtn.textContent = 'Delete';
        deleteBtn.addEventListener('click', () => {
          persistSaves([]);
          if (currentCharacter?.name === save.name && currentCharacter?.focus === save.focus) {
            currentCharacter = null;
            toggleCharacterMenu(false);
            showScreen('start');
          }
          renderSaves();
        });

        actions.append(loadBtn, deleteBtn);
        card.append(info, actions);
        saveList.appendChild(card);
      });
    }

    function addSave(save) {
      const completeSave = { ...save, archetype: save.archetype || 'femaleApprentice', appearance: ensureAppearance(save) };
      persistSaves([completeSave]);
    }

    function populateMapGrid(layout = towerClearingLayout) {
      if (!mapOverlay || !layout.length) return;
      const rows = layout.length;
      const cols = layout[0].length;
      mapOverlay.innerHTML = '';
      mapOverlay.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
      mapOverlay.style.gridTemplateRows = `repeat(${rows}, 1fr)`;

      layout.forEach((row, y) => {
        [...row].forEach((symbol, x) => {
          const def = tileLegend[symbol] || tileLegend.G;
          const tile = document.createElement('div');
          tile.className = 'tile';
          tile.dataset.symbol = symbol;
          tile.dataset.type = def.type;
          tile.title = `${def.label} (${x}, ${y})`;
          tile.textContent = symbol;
          mapOverlay.appendChild(tile);
        });
      });
    }

    function populateMapLegend() {
      if (!mapLegend) return;
      mapLegend.innerHTML = '';
      Object.entries(tileLegend).forEach(([symbol, def]) => {
        const span = document.createElement('span');
        span.innerHTML = `<strong>${symbol}</strong> – ${def.label}`;
        mapLegend.appendChild(span);
      });
    }

    function populateInventoryList() {
      inventoryList.innerHTML = '';
      inventoryItems.forEach((item) => {
        const card = document.createElement('div');
        card.className = 'inventoryCard';
        card.innerHTML = `<strong>${item.name}</strong><small>${item.slot}</small><p style="color: var(--muted)">${item.notes}</p>`;
        inventoryList.appendChild(card);
      });
    }

    function populatePeople() {
      if (!peopleList) return;
      peopleList.innerHTML = '';
      npcRoster.forEach((npc) => {
        const card = document.createElement('div');
        card.className = 'resourceCard';
        card.innerHTML = `<h5>${npc.role}</h5><p style="color: var(--muted);">${npc.look}</p><p style="color: var(--muted);">${npc.vibe}</p>`;
        peopleList.appendChild(card);
      });
    }

    function fillSelectOptions(select, options) {
      select.innerHTML = '';
      options.forEach((opt) => {
        const option = document.createElement('option');
        option.value = opt;
        option.textContent = opt;
        select.appendChild(option);
      });
    }

    function populateGearSelects() {
      fillSelectOptions(gearSelects.hatStyle, hatStyles);
      fillSelectOptions(gearSelects.hatColor, Object.keys(colorPalette));
      fillSelectOptions(gearSelects.shirtColor, Object.keys(colorPalette));
      fillSelectOptions(gearSelects.pantsColor, Object.keys(colorPalette));
      fillSelectOptions(gearSelects.robeColor, Object.keys(colorPalette));
    }

    function applyAppearance(appearance) {
      const preview = document.getElementById('characterPreview');
      const targets = [preview, mapHero].filter(Boolean);
      targets.forEach((target) => {
        target.style.setProperty('--hat', colorPalette[appearance.hatColor] || colorPalette.Dusk);
        target.style.setProperty('--shirt', colorPalette[appearance.shirtColor] || colorPalette.Meadow);
        target.style.setProperty('--pants', colorPalette[appearance.pantsColor] || colorPalette.Midnight);
        target.style.setProperty('--robe', colorPalette[appearance.robeColor] || colorPalette.Twilight);
      });
      gearLabels.hat.textContent = appearance.hatStyle;
      gearLabels.robe.textContent = `Robe: ${appearance.robeColor}`;
      gearLabels.shirt.textContent = `Tunic: ${appearance.shirtColor}`;
      gearLabels.pants.textContent = `Pants: ${appearance.pantsColor}`;
    }

    function syncGearControls(appearance) {
      gearSelects.hatStyle.value = appearance.hatStyle;
      gearSelects.hatColor.value = appearance.hatColor;
      gearSelects.shirtColor.value = appearance.shirtColor;
      gearSelects.pantsColor.value = appearance.pantsColor;
      gearSelects.robeColor.value = appearance.robeColor;
    }

    function hydrateGameUI() {
      if (!currentCharacter) return;
      currentCharacter.appearance = ensureAppearance(currentCharacter);
      document.getElementById('heroName').textContent = currentCharacter.name;
      const archetype = currentCharacter.archetype || 'femaleApprentice';
      const archetypeLabel = archetypeLabels[archetype] || 'Apprentice';
      document.getElementById('heroFocus').textContent = `${archetypeLabel} • Focus: ${currentCharacter.focus} • Zone: ${currentCharacter.zone}`;
      syncGearControls(currentCharacter.appearance);
      applyAppearance(currentCharacter.appearance);
    }

    function handleGearChange() {
      if (!currentCharacter) return;
      currentCharacter.appearance = ensureAppearance(currentCharacter);
      currentCharacter.appearance.hatStyle = gearSelects.hatStyle.value;
      currentCharacter.appearance.hatColor = gearSelects.hatColor.value;
      currentCharacter.appearance.shirtColor = gearSelects.shirtColor.value;
      currentCharacter.appearance.pantsColor = gearSelects.pantsColor.value;
      currentCharacter.appearance.robeColor = gearSelects.robeColor.value;
      applyAppearance(currentCharacter.appearance);
      setPreview('Gear updated — changes will save with your file.');
    }

    function activateTab(targetId) {
      const buttons = document.querySelectorAll('[data-tab-target]');
      const panels = document.querySelectorAll('.tabContent');
      buttons.forEach((btn) => {
        const isActive = btn.dataset.tabTarget === targetId;
        btn.classList.toggle('active', isActive);
        btn.setAttribute('aria-selected', isActive.toString());
      });
      panels.forEach((panel) => {
        panel.classList.toggle('active', panel.id === targetId);
      });
    }

    function toggleCharacterMenu(forceState) {
      const shouldOpen = typeof forceState === 'boolean' ? forceState : !characterMenu.classList.contains('active');
      characterMenu.classList.toggle('active', shouldOpen);
      characterMenu.setAttribute('aria-hidden', (!shouldOpen).toString());
      if (shouldOpen) {
        activateTab(document.querySelector('[data-tab-target].active')?.dataset.tabTarget || 'inventory');
      }
    }

    // Event wiring
    document.getElementById('newCharacter').addEventListener('click', () => {
      currentCharacter = null;
      showScreen('character');
    });

    document.getElementById('openSaves').addEventListener('click', () => {
      showScreen('save');
    });

    document.getElementById('saveBack').addEventListener('click', () => showScreen('start'));
    document.getElementById('characterBack').addEventListener('click', () => showScreen('start'));
    document.getElementById('zoneBack').addEventListener('click', () => showScreen('character'));
    document.getElementById('gameBack').addEventListener('click', () => showScreen('start'));
    backButton.addEventListener('click', () => showScreen('start'));

    document.getElementById('createCharacter').addEventListener('click', () => {
      const name = document.getElementById('charName').value.trim() || 'Apprentice';
      const focus = document.getElementById('charFocus').value;
      const archetype = archetypeSelect.value || 'femaleApprentice';
      currentCharacter = { name, focus, archetype, zone: 'Forest', appearance: getDefaultAppearance(archetype) };
      showScreen('zone');
    });

    document.getElementById('startForest').addEventListener('click', () => {
      if (!currentCharacter) {
        currentCharacter = { name: 'Apprentice', focus: 'Elemental', archetype: 'femaleApprentice', zone: 'Forest', appearance: getDefaultAppearance('femaleApprentice') };
      }
      currentCharacter.zone = 'Forest';
      currentCharacter.appearance = ensureAppearance(currentCharacter);
      showScreen('game');
    });

    document.getElementById('saveProgress').addEventListener('click', () => {
      if (currentCharacter) addSave(currentCharacter);
      setPreview('Progress saved locally.');
    });

    document.querySelectorAll('[data-tab-target]').forEach((btn) => {
      btn.addEventListener('click', () => activateTab(btn.dataset.tabTarget));
    });

    openCharacterMenu.addEventListener('click', () => toggleCharacterMenu(true));
    closeCharacterMenu.addEventListener('click', () => toggleCharacterMenu(false));

    document.addEventListener('keydown', (event) => {
      const targetTag = event.target.tagName.toLowerCase();
      const typingField = targetTag === 'input' || targetTag === 'select' || targetTag === 'textarea';
      if (typingField) return;
      if (event.key.toLowerCase() === 'c' && screens.game.classList.contains('active')) {
        event.preventDefault();
        toggleCharacterMenu();
      }
    });

    Object.values(gearSelects).forEach((select) => {
      select.addEventListener('change', handleGearChange);
    });

    // Initialize
    populateMapGrid();
    populateMapLegend();
    populateGearSelects();
    populateInventoryList();
    populatePeople();
    showScreen('start');
    toggleCharacterMenu(false);
  </script>
</body>
</html>
